<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Dashboard Quản trị</h2>
</div>

<div class="row mb-4" id="statsCards">
    <!-- Stats cards will be loaded here -->
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Đơn hàng gần đây</h5>
            </div>
            <div class="card-body" id="recentOrders">
                <!-- Recent orders will be loaded here -->
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Quản lý nhanh</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="/admin/products" class="btn btn-outline-primary">Quản lý sản phẩm</a>
                    <a href="/admin/orders" class="btn btn-outline-success">Quản lý đơn hàng</a>
                    <a href="/admin/users" class="btn btn-outline-info">Quản lý người dùng</a>
                    <a href="/admin/reviews" class="btn btn-outline-warning">Duyệt đánh giá</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function loadDashboardStats() {
    const token = localStorage.getItem('token');
    
    try {
        const response = await fetch('/api/v1/admin/dashboard', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        const result = await response.json();
        const stats = result.data || result;
        
        displayStats(stats);
    } catch (error) {
        console.error('Error loading dashboard stats:', error);
    }
}

function displayStats(stats) {
    const statsCards = document.getElementById('statsCards');
    
    statsCards.innerHTML = `
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4>${stats.totalOrders || 0}</h4>
                            <p class="mb-0">Tổng đơn hàng</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-shopping-cart fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4>${stats.totalUsers || 0}</h4>
                            <p class="mb-0">Tổng người dùng</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-users fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4>${stats.totalProducts || 0}</h4>
                            <p class="mb-0">Tổng sản phẩm</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-box fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4>${formatPrice(stats.totalRevenue || 0)}</h4>
                            <p class="mb-0">Tổng doanh thu</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-dollar-sign fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Check admin access
function checkAdminAccess() {
    const user = getCurrentUser();
    if (!user || user.role !== 'admin') {
        alert('Bạn không có quyền truy cập trang này');
        window.location.href = '/';
        return false;
    }
    return true;
}

// Load dashboard on page load
document.addEventListener('DOMContentLoaded', () => {
    if (checkAdminAccess()) {
        loadDashboardStats();
    }
});
</script>
