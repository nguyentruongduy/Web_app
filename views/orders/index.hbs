<h2>Đơn hàng của tôi</h2>

<div id="ordersList">
    <!-- Orders will be loaded here -->
</div>

<script>
async function loadOrders() {
    const token = localStorage.getItem('token');
    if (!token) {
        window.location.href = '/login';
        return;
    }
    
    try {
        const response = await fetch('/api/v1/orders/my-orders', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        const result = await response.json();
        const orders = result.data || result;
        
        displayOrders(orders);
    } catch (error) {
        console.error('Error loading orders:', error);
    }
}

function displayOrders(orders) {
    const ordersList = document.getElementById('ordersList');
    
    if (!orders || orders.length === 0) {
        ordersList.innerHTML = `
            <div class="text-center py-5">
                <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
                <h4>Chưa có đơn hàng nào</h4>
                <p class="text-muted">Hãy đặt hàng để xem lịch sử đơn hàng</p>
                <a href="/products" class="btn btn-primary">Mua sắm ngay</a>
            </div>
        `;
        return;
    }
    
    ordersList.innerHTML = orders.map(order => `
        <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="mb-0">Đơn hàng #${order._id}</h6>
                    <small class="text-muted">${new Date(order.createdAt).toLocaleDateString('vi-VN')}</small>
                </div>
                <div>
                    <span class="badge bg-${getStatusColor(order.status)}">${getStatusText(order.status)}</span>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h6>Sản phẩm:</h6>
                        ${order.items.map(item => `
                            <div class="d-flex align-items-center mb-2">
                                <img src="${item.productId.image || '/placeholder.svg?height=50&width=50'}" class="me-3" style="width: 50px; height: 50px; object-fit: cover;" alt="${item.productId.name}">
                                <div>
                                    <div>${item.productId.name}</div>
                                    <small class="text-muted">Số lượng: ${item.quantity} x ${formatPrice(item.price)}</small>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="col-md-4">
                        <h6>Thông tin đơn hàng:</h6>
                        <p><strong>Tổng tiền:</strong> ${formatPrice(order.totalAmount)}</p>
                        <p><strong>Địa chỉ giao hàng:</strong><br>${order.shippingAddress}</p>
                        <p><strong>Phương thức thanh toán:</strong> ${order.paymentMethod}</p>
                        <a href="/orders/${order._id}" class="btn btn-outline-primary btn-sm">Xem chi tiết</a>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
}

function getStatusColor(status) {
    const colors = {
        'pending': 'warning',
        'confirmed': 'info',
        'shipped': 'primary',
        'delivered': 'success',
        'cancelled': 'danger'
    };
    return colors[status] || 'secondary';
}

function getStatusText(status) {
    const texts = {
        'pending': 'Chờ xử lý',
        'confirmed': 'Đã xác nhận',
        'shipped': 'Đang giao',
        'delivered': 'Đã giao',
        'cancelled': 'Đã hủy'
    };
    return texts[status] || status;
}

// Load orders on page load
document.addEventListener('DOMContentLoaded', loadOrders);
</script>
